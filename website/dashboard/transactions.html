<!DOCTYPE html>
<html lang="en">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
      <!-- Primary Meta Tags -->
      <title>GriffinCoin - Transactions</title>
      <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
      <!-- Favicon -->
      <link rel="apple-touch-icon" sizes="120x120" href="/static/favicons/apple-touch-icon.png">
      <link rel="icon" type="image/png" sizes="32x32" href="/static/favicons/favicon-32x32.png">
      <link rel="icon" type="image/png" sizes="16x16" href="/static/favicons/favicon-16x16.png">
      <link rel="manifest" href="/static/favicons/site.webmanifest">
      <meta name="msapplication-TileColor" content="#da532c">
      <meta name="theme-color" content="#ffffff">
      <!-- Sweet Alert -->
      <link type="text/css" href="./vendor/sweetalert2/dist/sweetalert2.min.css" rel="stylesheet">
      <!-- Notyf -->
      <link type="text/css" href="./vendor/notyf/notyf.min.css" rel="stylesheet">
      <!-- Volt CSS -->
      <link type="text/css" href="./css/volt.css" rel="stylesheet">
      <!-- NOTICE: You can use the _analytics.html partial to include production code specific code & trackers -->
      <script src="https://cdn.jsdelivr.net/npm/js-cookie@3.0.0/dist/js.cookie.min.js"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js" integrity="sha512-894YE6QWD5I59HgZOGReFYm4dnWc1Qt5NtvYSaNcOP+u1T9qYdvdihz0PPSiiqn/+/3e7Jo4EaG7TubfWGUrMQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
      <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/v/bs5/dt-1.10.25/datatables.min.css"/>
      <script type="text/javascript" src="https://cdn.datatables.net/v/bs5/dt-1.10.25/datatables.min.js"></script>

      <!-- Core -->
      <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-KyZXEAg3QhqLMpG8r+8fhAXLRk2vvoC2f3B09zVXn8CA5QIVfZOJ3BCsw2P0p/We" crossorigin="anonymous">
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.0/dist/js/bootstrap.bundle.min.js" integrity="sha384-U1DAWAznBHeqEIlVSCgzq+c9gqGAJn5c/t99JyeKa9xxaYpSvHU5awsuZVVFIhvj" crossorigin="anonymous"></script>
      <!-- Vendor JS -->
      <script src="./vendor/onscreen/dist/on-screen.umd.min.js"></script>
      <!-- Slider -->
      <script src="/dashboard/vendor/nouislider/dist/nouislider.min.js"></script>
      <!-- Smooth scroll -->
      <script src="./vendor/smooth-scroll/dist/smooth-scroll.polyfills.min.js"></script>
      <!-- Charts -->
      <script src="./vendor/chartist/dist/chartist.min.js"></script>
      <script src="./vendor/chartist-plugin-tooltips/dist/chartist-plugin-tooltip.min.js"></script>
      <!-- Datepicker -->
      <script src="./vendor/vanillajs-datepicker/dist/js/datepicker.min.js"></script>
      <!-- Sweet Alerts 2 -->
      <script src="./vendor/sweetalert2/dist/sweetalert2.all.min.js"></script>
      <!-- Moment JS -->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.27.0/moment.min.js"></script>
      <!-- Vanilla JS Datepicker -->
      <script src="./vendor/vanillajs-datepicker/dist/js/datepicker.min.js"></script>
      <!-- Notyf -->
      <script src="./vendor/notyf/notyf.min.js"></script>
      <!-- Simplebar -->
      <script src="./vendor/simplebar/dist/simplebar.min.js"></script>
      <!-- Volt JS -->
      <script src="./assets/js/volt.js"></script>

      <style>
         body{
          font-family: monospace !important;
         }

         kbd:hover{
          color:rgb(51,255,51) !important;
        }
      </style>
   </head>
   <body>
      <!-- NOTICE: You can use the _analytics.html partial to include production code specific code & trackers -->
      <script>
         //verify the current user credential
         var username = Cookies.get('username');
         var password = Cookies.get('password');
         var user;
         var data;
         
         if(!username || !password) logout();
         
         $.ajax({
             type: "POST",
             async: true,
             url: "/login",
             cache: false,
             data: {
                  username:username,
                  password:password,
             },
             success: function(result){
                 var status = result.status;
                 if(status != "success"){ //error
                     logout();
                     return;
                 }
                 user = result.user;
             },
         });

         Swal.fire({
           text: 'curl -d "username='+username+'" -x POST /get_user_transactions',
           icon:'info',
            showConfirmButton: false,
          });

         $.ajax({
             type: "POST",
             async: true,
             url: "/get_user_transactions",
             cache: false,
             data: {
                 username:username
             },
             success: function(result){
               result =  JSON.parse(result);
                 var status = result.status;
                 if(status != "success"){ //error
                     Swal.fire('ERR::get_transaction',status,'error');
                     return;
                 }
                 Swal.close();
                 data = result.transactions;

                  $('#table').DataTable({
                    responsive: true,
                    data:data,
                    columns: [
                        { title: "Receiver" },
                        { title: "Amount" },
                        { title: "Hash" },
                        { title: "Tax" },
                        { title: "Time" },
                      ],
                      "language": {
                          "zeroRecords": "Records: NULL",
                      },
                      
                  });
             },
         });
         
         
         function logout(){
             try{
                 Cookies.remove('username', { path: '/' })
                 Cookies.remove('password', { path: '/' })
                 Cookies.remove('public_key', { path: '/' })
                 Cookies.remove('private_key', { path: '/' })
             }
             finally{
                 setTimeout(()=>{window.location.href = "/login";},300);
             }
         }

         function createTransaction(){
            var sender_private_key = user.private_key;
            var recipient_public_key = $('#recipient_public_key').val();
            var transaction_amount = $('#transaction_amount').val();

            Swal.fire({
            text: 'curl -d "sender_private_key='+sender_private_key+'&recipient_public_key='+recipient_public_key+'&amount='+transaction_amount+'&" -x POST /create_transaction',
            icon:'info',
               showConfirmButton: false,
            });
            
            $.ajax({
               type: "POST",
               async: true,
               url: "/create_transaction",
               cache: false,
               data: {
                  sender_private_key:sender_private_key,
                  recipient_public_key:recipient_public_key,
                  amount:transaction_amount
               },
               success: function(result){
                  result =  JSON.parse(result);
                  var status = result.status;
                  if(status != "success"){ //error
                        Swal.fire('ERR::create_transaction',status,'error');
                        return;
                  }
                  Swal.close();
                  Swal.fire({
                     text:JSON.stringify(result,null,2),
                     icon:'success'
                  })
               },
               error: function(xhr, ajaxOptions, thrownError){
                  Swal.close();
                  Swal.fire({
                     title:xhr.status,
                     text:JSON.stringify(thrownError,null,2),
                     icon:'error'
                  })
               }
            });
         }
         
      </script>
      <nav class="navbar navbar-dark navbar-theme-primary px-4 col-12 d-lg-none">
         <a class="navbar-brand me-lg-5" href="./index.html">
         <img class="navbar-brand-dark" src="./assets/img/brand/light.svg" alt="Volt logo" /> <img class="navbar-brand-light" src="./assets/img/brand/dark.svg" alt="Volt logo" />
         </a>
         <div class="d-flex align-items-center">
            <button class="navbar-toggler d-lg-none collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#sidebarMenu" aria-controls="sidebarMenu" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
            </button>
         </div>
      </nav>
      <nav id="sidebarMenu" class="sidebar d-lg-block bg-gray-800 text-white collapse" data-simplebar>
         <div class="sidebar-inner px-4 pt-3">
            <ul class="nav flex-column pt-3 pt-md-0">
               <li class="nav-item">
                  <a href="/dashboard/index.html" class="nav-link">
                     <span class="sidebar-icon">
                        <svg class="icon icon-xs me-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                           <path d="M2 10a8 8 0 018-8v8h8a8 8 0 11-16 0z"></path>
                           <path d="M12 2.252A8.014 8.014 0 0117.748 8H12V2.252z"></path>
                        </svg>
                     </span>
                     <span class="sidebar-text">Dashboard</span>
                  </a>
               </li>
               <li class="nav-item active">
                  <a href="/dashboard/transactions.html" class="nav-link">
                     <span class="sidebar-icon">
                        <svg class="icon icon-xs me-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                           <path d="M4 4a2 2 0 00-2 2v1h16V6a2 2 0 00-2-2H4z"></path>
                           <path fill-rule="evenodd" d="M18 9H2v5a2 2 0 002 2h12a2 2 0 002-2V9zM4 13a1 1 0 011-1h1a1 1 0 110 2H5a1 1 0 01-1-1zm5-1a1 1 0 100 2h1a1 1 0 100-2H9z" clip-rule="evenodd"></path>
                        </svg>
                     </span>
                     <span class="sidebar-text">Transactions</span>
                  </a>
               </li>
               <li class="nav-item ">
                  <a href="/dashboard/settings.html" class="nav-link">
                     <span class="sidebar-icon">
                        <svg class="icon icon-xs me-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                           <path fill-rule="evenodd" d="M11.49 3.17c-.38-1.56-2.6-1.56-2.98 0a1.532 1.532 0 01-2.286.948c-1.372-.836-2.942.734-2.106 2.106.54.886.061 2.042-.947 2.287-1.561.379-1.561 2.6 0 2.978a1.532 1.532 0 01.947 2.287c-.836 1.372.734 2.942 2.106 2.106a1.532 1.532 0 012.287.947c.379 1.561 2.6 1.561 2.978 0a1.533 1.533 0 012.287-.947c1.372.836 2.942-.734 2.106-2.106a1.533 1.533 0 01.947-2.287c1.561-.379 1.561-2.6 0-2.978a1.532 1.532 0 01-.947-2.287c.836-1.372-.734-2.942-2.106-2.106a1.532 1.532 0 01-2.287-.947zM10 13a3 3 0 100-6 3 3 0 000 6z" clip-rule="evenodd"></path>
                        </svg>
                     </span>
                     <span class="sidebar-text">Settings</span>
                  </a>
               </li>
               <li class="nav-item ">
                  <a href="javascript:logout();" class="nav-link">
                     <span class="sidebar-icon">
                        <svg class="icon icon-xs me-2" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                           <path fill-rule="evenodd" d="M3 3a1 1 0 00-1 1v12a1 1 0 102 0V4a1 1 0 00-1-1zm10.293 9.293a1 1 0 001.414 1.414l3-3a1 1 0 000-1.414l-3-3a1 1 0 10-1.414 1.414L14.586 9H7a1 1 0 100 2h7.586l-1.293 1.293z" clip-rule="evenodd"></path>
                        </svg>
                     </span>
                     <span class="sidebar-text">Logout</span>
                  </a>
               </li>
            </ul>
         </div>
      </nav>
      <main class="content font-monospace" style="min-height:500px;">
         <div class="modal fade" id="modal-transaction" tabindex="-1" role="dialog" aria-labelledby="modal-transaction" aria-hidden="true">
            <div class="modal-dialog modal-dialog-centered" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h2 class="h6 modal-title">$ ./new-transaction.sh</h2>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <div class="mb-3">
                           <label for="public_key" class="form-label">$recipient_public_key</label>
                           <input type="text" class="form-control" id="recipient_public_key" placeholder="$recipient_public_key">
                        </div>
                        <div class="mb-3">
                           <label for="transaction_amount" class="form-label">$amount</label>
                           <input type="number" class="form-control" id="transaction_amount" placeholder="$amount">
                        </div>
                    </div>
                    <div class="modal-footer">
                        <a class="text-decoration-none" style="cursor:pointer" href="javascript:createTransaction()"><kbd>$ ./send.sh</kbd></a>
                    </div>
                </div>
            </div>
        </div>

         <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center py-4">
            <div class="d-block mb-4 mb-md-0">
               <nav aria-label="breadcrumb" class="d-none d-md-inline-block">
                  <ol class="breadcrumb breadcrumb-dark breadcrumb-transparent">
                     <li class="breadcrumb-item">User</li>
                     <li class="breadcrumb-item active" aria-current="page">Transactions</li>
                  </ol>
               </nav>
               <h2 class="h4">All Transactions</h2>
               <p class="mb-0">NEED TO CHANGE THIS TO A SHORT DESC</p>
            </div>
            <div class="btn-toolbar mt-5 mb-2 mb-md-0">
              <a class="text-decoration-none mb-5" href="javascript:void"  data-bs-toggle="modal" data-bs-target="#modal-transaction"><kbd class="hacker">$ ./new-transaction.sh</kbd></a>
              <small style="margin-left: .5rem;margin-right: .5rem;">/</small>
              <a class="text-decoration-none mb-5" href="javascript:smartContract()"><kbd class="hacker">$ ./smart-contract.sh</kbd></a>
            </div>
         </div>
         <div class="card card-body shadow border-0 table-wrapper table-responsive">
            <table class="table table-hover" id="table">
               
            </table>
      </main>
   </body>
</html>